<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>GeoAR.js demo</title>
    <script src='https://aframe.io/releases/0.9.2/aframe.min.js'></script>
    <script src="https://raw.githack.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script>
        THREEx.ArToolkitContext.baseURL = 'https://raw.githack.com/jeromeetienne/ar.js/master/three.js/'
    </script>
    <script src="https://kit.fontawesome.com/9a416a1cca.js" crossorigin="anonymous"></script>
</head>

<link rel="stylesheet" href="./index.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />


<body style='margin: 0; overflow: hidden;'>



    <a-scene
        cursor='rayOrigin: mouse; fuse: true; fuseTimeout: 0;'
        raycaster="objects: [gps-entity-place];useWorldCoordinates:true"
        vr-mode-ui='enabled: false' 
            arjs='sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: false;'>

        <a-entity gltf-model="https://dylan1211-hub.github.io/smalltest/bus_test/assets/billboard/scene.gltf" rotation="0 0 0" scale="5 5 5" 
            gps-entity-place="longitude: 120.45896646526651; latitude: 22.534673656027547;" animation-mixer >
        <a-text value="Cody is gay. \n Dylan is handsome. " color="gray" zOffset="9999" anchor="left" baseline="top" scale="0.3 0.3 0.3" position="-0.3 0.65 1"></a-text>
        </a-entity>

        <a-camera gps-camera rotation-reader>
            <input type="checkbox"  id="side-menu-switch">
            <div class="side-menu">
                        
                <nav>
                           
                </nav>
                <label for="side-menu-switch">
                    <i class="fas fa-angle-left"></i>
                </label>
            </div>
        </a-camera>

	</a-scene>

    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        //介接的part



        //渲染的part

        



        //OSM leaflet(web map)的part
        document.addEventListener('DOMContentLoaded', () => {  

        const zoo = [22.998593072090404, 120.2197879523883]; // 預設中心點為台北市動物園

        // 建立地圖
        const map = L.map('map', {
        attributionControl: false, // 是否秀出 leaflet
        zoomControl: false , // 是否秀出 - + 按鈕
        zoom: 17, // 0-18
        });
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);



        // 建立 marker
        const customIcon = L.icon({
        iconUrl: 'https://letswritetw.github.io/letswrite-leaflet-osm-locate/dist/dot.svg',
        iconSize: [16, 16],
        });
        const marker = L.marker(zoo, {
        icon: customIcon,
        title: '跟 <a> 的 title 一樣', // 跟 <a> 的 title 一樣
        opacity: 1.0
        }).addTo(map);


        // 跟使用者要位置
        // 參考文件：https://leafletjs.com/examples/mobile/、https://leafletjs.com/reference-1.7.1.html#map-locate
        map.locate({ setView: true, watch: true, maxZoom: 18, enableHighAccuracy: true });

        // 使用者不提供位置
        function errorHandler(e) {
        console.log("e", e);
        window.alert('無法判斷您的所在位置，無法使用此功能。預設地點將為 測量系館');
        map.setView(zoo, 18); // 中心移到動物園
        moveTo(map); // 移動到指定座標（平滑 || 縮放 效果）
        panBy(map); // 移動 x, y 位置
        }
        map.on('locationerror', errorHandler);

        // 使用者提供位置
        function foundHandler(e) {
        console.log("e", e);
        marker.setLatLng(e.latlng); // 移動 marker
        map.setView(e.latlng, 17);
        moveTo(map); // 移動到指定座標（平滑 || 縮放 效果）
        panBy(map); // 移動 x, y 位置
        }
        map.on('locationfound', foundHandler);


        // 移動到指定座標（平滑 || 縮放 效果）
        function moveTo(map) {
        const btnPanto = document.querySelectorAll('.js-panto');
        Array.prototype.forEach.call(btnPanto, pan => {
            pan.addEventListener('click', e => {
            e.preventDefault();
            let latLng = e.target.dataset.to.split(',');
            let name = e.target.textContent;
            let toggleFly = document.getElementById('flyTo').checked;
            const popup = L.popup();
            popup
                .setLatLng(latLng)
                .setContent(`${name}`)
                .openOn(map);
            toggleFly ? map.flyTo(latLng) : map.panTo(latLng);
            })
        })
        }

        // 移動 x, y 位置
        function panBy(map) {
        const btnPanby = document.querySelectorAll('.js-panby');
        Array.prototype.forEach.call(btnPanby, pan => {
            pan.addEventListener('click', e => {
            e.preventDefault();
            let times = e.target.dataset.times;
            let point = 50 * times;
            let points = [point, point];
            map.panBy(points);
            })
        })
        }
        var MyIcon = L.icon({
        iconUrl: './assets/r.png',
        iconSize:     [10, 10], // size of the icon
        shadowSize:   [50, 64], // size of the shadow
        iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
        shadowAnchor: [4, 62],  // the same for the shadow
        popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
        });

        L.geoJson(stores,{icon: MyIcon}).addTo(map);

        })
    </script>
   

</body>